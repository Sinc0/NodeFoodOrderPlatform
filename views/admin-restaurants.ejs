<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/main.css">
    <link rel="stylesheet" href="/mobile.css">
    <link rel="shortcut icon" href="/icon.png" type="image/x-icon">
    <title>Restaurants</title>
</head>

<script>
    function displayEditRestaurant(number)
    {
        //elements
        let restaurantCard = document.getElementById("restaurant#" + number);
        let editCard = document.getElementById("edit-restaurant#" + number);
        let cards = document.getElementsByClassName("admin-card")
        
        //undisplay all cards
        for(let i = 0; i < cards.length; i++)
        {
            cards[i].style.display = "none"
        }
        
        //update elements
        restaurantCard.hidden = true;
        editCard.hidden = false;
    }

    function undisplayEditRestaurant(number)
    {
        //elements
        let restaurantCard = document.getElementById("restaurant#" + number);
        let editCard = document.getElementById("edit-restaurant#" + number);
        let cards = document.getElementsByClassName("admin-card")
        
        //undisplay all cards
        for(let i = 0; i < cards.length; i++)
        {
            cards[i].style.display = "block"
        }
        
        //update elements
        restaurantCard.hidden = false;
        editCard.hidden = true;
    }

    function search(totalRestaurants)
    {
        //elements
        let searchBoxInput = document.getElementById("searchBoxInput").value
        let totalText = document.getElementById("totalText");
        let cards = document.getElementsByClassName("admin-card")
        let searchHits = 0

        //search box
        if(searchBoxInput == "")
        {
            //display all cards
            for(let i = 0; i < cards.length; i++)
            {
                cards[i].style.display = "block"
            }

            //set total restaurants
            totalText.innerText = totalRestaurants.toString() + " Restaurants"
        }
        else if(searchBoxInput != "")
        {
            //undisplay all cards
            for(let i = 0; i < cards.length; i++)
            {
                cards[i].style.display = "none"
            }

            //display search hit cards
            for(let i = 0; i < cards.length; i++)
            {
                if(cards[i].innerText.includes(searchBoxInput))
                {
                    cards[i].style.display = "block"
                    searchHits++
                }
            }

            //set total restaurants
            totalText.innerText = searchHits.toString() + " Restaurants"
        }
    }
</script>

<style>
    /*** elements ***/
    body { background-color: #3c41d6; }
    input { color: white; border: 0px solid black; background-color: black; }

    /*** classes ***/
    .admin-edit { width: auto; padding: 0px 10px 0px 10px; margin: auto; user-select: none; border: 1px solid black; background-color: white; }
    .admin-card
    {
        margin: auto; 
        padding: 10px; 
        user-select: none;
        font-weight: bold;
        border-bottom: 1px solid black; 
        background-color: white;
    }
    .admin-card-button
    {
        display: inline-block;
        width: 119px;
        margin: 30px 0px 30px 0px;
        padding: 12px 0px 12px 0px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        border: 0px solid black;
        background-color: transparent; 
    }
    .cardText { margin: 0px; }
    .input-admin { width: 360px; margin-left: 7px; padding: 10px 0px 10px 7px; font-weight: bold; font-size: 16px; }
    .label-admin { display: block; padding: 20px 0px 0px 7px; }
    
    /*** ids ***/
    #searchBox { width: 400px; margin: auto; border: 0px solid black; }
    #searchBoxInput { height: 40px; font-weight: normal; color: white; background-color: black; }
    #totalText { margin: 20px 0px 20px 0px; font-size: 20px; text-align: center; text-shadow: 1px 1px black; user-select: none; color: white; }
    #orders { width: 400px; margin: auto; }
    #cardButtons { margin: 20px 0px 0px 0px;}
    #restaurantTitle { margin: 0px 0px 10px 0px; font-size: 20px; font-weight: bold; }
    #restaurants { height: 80vh; width: 400px; margin: auto; overflow-y: scroll; }
    #formDelete { display: inline; }
    #formEdit { display: inline; }
    #cancelButton { }
    #editButton { margin-left: 7px; background-color: lightgreen; }
    #deleteButton { background-color: red; }

    /*** mobile ***/
    @media screen and (max-width: 1000px) {
        .input-admin { width: 90%; }
        .input-label { width: 90%; }
        .admin-card-button { width: 30%; }

        #searchBox { display: block; width: 90vw; margin: auto; margin-top: 10px; }
        #restaurants { height: 70vh; width: 90vw; }
    }
</style>

<body>
    <!-- nav menu -->
    <%- include('nav-menu-admin.ejs') %>
    
    <!-- search box -->
    <div id="searchBox">
        <input id="searchBoxInput" placeholder="Search..." onkeyup="search('<%=restaurants.length %>')"></input>
    </div>
    
    <!-- total restaurants -->
    <h3 id="totalText"><%=restaurants.length %> Restaurants</h3>

    <!-- restaurants -->
    <div id="restaurants">
        <% for(var i = 0; i < restaurants.length; i++) { %>
            <!-- restaurant email -->
            <div id="restaurant#<%=i + 1%>" class="admin-card" onclick="displayEditRestaurant('<%=i + 1%>')">      
                <p class="cardText"><%=restaurants[i].email %></p>
            </div>
    
            <!-- edit modal -->
            <div class="admin-edit" hidden id="edit-restaurant#<%=i + 1%>">
                <form id="formEdit" action="/admin/edit-restaurant" method="POST">
                    <input hidden class="input-admin" name="id" value="<%=restaurants[i]._id %>"></input>
                    <label class="label-admin">Email</label>
                    <input class="input-admin" name="email" value="<%=restaurants[i].email %>"></input>
                    <label class="label-admin">Title</label>
                    <input class="input-admin" name="title" value="<%=restaurants[i].title %>"></input>
                    <label class="label-admin">Owner</label>
                    <input class="input-admin" name="owner" value="<%=restaurants[i].owner %>"></input>
                    <label class="label-admin">Address</label>
                    <input class="input-admin" name="address" value="<%=restaurants[i].address %>"></input>
                    <!-- edit -->
                    <button id="editButton" class="admin-card-button">Update</button>
                </form>

                <!-- cancel -->
                <button id="cancelButton" class="admin-card-button" onclick="undisplayEditRestaurant('<%=i + 1%>')">Cancel</button>

                <!-- delete -->
                <form id="formDelete" action="/admin/delete-restaurant" method="POST">
                    <input hidden name="restaurantId" value="<%=restaurants[i]._id %>"></input>
                    <button id="deleteButton"  class="admin-card-button">Delete</button>
                </form>
            </div>
        <% } %>
    </div>
</body>
</html>